# Test Fixtures for globtimpostprocessing

This directory contains realistic test data generated by globtimcore using the Deuflhard_4d benchmark function.

## Files

- `critical_points_raw_deg_4.csv` - 81 raw critical points from degree 4 polynomial approximation
- `critical_points_raw_deg_6.csv` - 289 raw critical points from degree 6 polynomial approximation
- `experiment_config.json` - Experiment metadata (function, domain, basis, grid size)
- `results_summary.json` - Summary statistics across degrees
- `test_functions.jl` - Objective function definitions for use in tests

## Test Function: Deuflhard_4d

**Mathematical form:**
```
f(p) = Deuflhard(p[1:2]) + Deuflhard(p[3:4])

where Deuflhard(x,y) = (exp(x² + y²) - 3)² + (x + y - sin(3(x + y)))²
```

**Domain:** `[-1.2, 1.2]^4`

**Properties:**
- Parameter-free (not a parameter estimation problem)
- Multiple local minima
- Global minimum at approximately `[0, 0, 0, 0]` with `f([0,0,0,0]) ≈ 0`
- Fast to evaluate (no ODE solving required)
- Well-conditioned for optimization
- Smooth and differentiable everywhere

**Use cases:**
- Testing data loading functions
- Testing refinement algorithms (BFGS local optimization)
- Function minimization (not parameter recovery)
- Validating CSV format parsing

## CSV Format (globtimcore Phase 2)

```csv
index,p1,p2,p3,p4,objective
1,0.6942833834207304,0.6942833834207255,0.6942833834207333,0.6942833834207208,10.345746447679158
2,0.2137894425015416,0.9310041959573789,0.6942833834207329,0.6942833834207212,7.487168793976863
...
```

**Column descriptions:**
- `index`: Sequential row number (1-indexed)
- `p1, p2, p3, p4`: Coordinates of critical point in 4D space
- `objective`: Function value at the critical point

**Naming convention:**
- Phase 2 (current): `critical_points_raw_deg_X.csv`
- Phase 1 (legacy): `critical_points_deg_X.csv`

The loader function `load_critical_points_for_degree()` supports both formats automatically.

## Experiment Configuration

**Grid settings:**
- Dimension: 4D
- Grid size (GN): 10 samples per dimension (10^4 = 10,000 total grid points)
- Domain: `[-1.2, 1.2]^4` (centered at origin)
- Basis: Chebyshev

**Polynomial approximation:**
- Degrees tested: 4, 6
- L2 norms:
  - Degree 4: ~64.58 (moderate approximation quality)
  - Degree 6: ~26.33 (better approximation)

**Critical point statistics:**
- Degree 4: 81 points in domain
- Degree 6: 289 points in domain

## Regenerating Fixtures

To regenerate test fixtures with the latest globtimcore version:

```bash
cd /path/to/globtimcore/test/fixtures
julia --project=../.. generate_postprocessing_fixtures.jl
```

**When to regenerate:**
- After changing globtimcore's CSV export format
- After updating critical point filtering logic
- When Phase 2 schema changes
- To update with latest globtimcore algorithms

**Generation time:** ~20 seconds (depends on HomotopyContinuation solving)

## Test Usage

### Loading test function

```julia
include("fixtures/test_functions.jl")

# Use in refinement test
refined = refine_critical_point(deuflhard_4d_fixture, initial_point, config)

# Verify critical point (gradient should be near zero)
grad_norm = norm(ForwardDiff.gradient(deuflhard_4d_fixture, point))
@test grad_norm < 1e-6
```

### Loading CSV data

```julia
using GlobtimPostProcessing

# Load critical points (automatically detects Phase 2 format)
df = load_critical_points_for_degree(fixtures_dir, 4)

# Access columns
indices = df.index
points = [df[i, Symbol("p$j")] for i in 1:nrow(df), j in 1:4]
objectives = df.objective

# Find global minimum
min_idx = argmin(df.objective)
best_point = [df[min_idx, Symbol("p$i")] for i in 1:4]
best_value = df[min_idx, :objective]
```

### Loading configuration

```julia
config = load_experiment_config(fixtures_dir)

function_name = config["function_name"]  # "Deuflhard_4d"
dimension = config["dimension"]          # 4
basis = config["basis"]                  # "chebyshev"
```

## Differences from Legacy Fixtures

| Aspect | Phase 1 (Legacy) | Phase 2 (Current) |
|--------|-----------------|-------------------|
| **Filename** | `critical_points_deg_X.csv` | `critical_points_raw_deg_X.csv` |
| **Columns** | `x1, x2, ..., z` | `index, p1, p2, ..., objective` |
| **Data source** | Hand-crafted | Real globtimcore output |
| **Function** | Generic test | Deuflhard_4d |
| **p_true** | Has p_true | No p_true (parameter-free) |
| **Size** | 3-5 points | 81-289 points |
| **Purpose** | Schema validation | Integration testing |

## Related Documentation

- `globtimcore/test/fixtures/generate_postprocessing_fixtures.jl` - Generator script
- `globtimcore/src/LibFunctions.jl` - Deuflhard_4d function definition
- `globtimcore/test/validation/deuflhard_4d_minimal.jl` - Usage example
- `globtimpostprocessing/src/ParameterRecovery.jl` - Loader functions

## Changelog

- **2025-11-24**: Initial fixtures generated
  - 81 points for degree 4
  - 289 points for degree 6
  - Deuflhard_4d function (4D, parameter-free)
  - Phase 2 CSV format with index and objective columns
